# Chezmoi configuration template
# Auto-detects machine type, prompts for confirmation on first run

{{- $profile := "bare-metal" -}}
{{- $wm := "sway" -}}
{{- $scale := "1.0" -}}
{{- $multimonitor := false -}}
{{- $terminal := "ghostty" -}}
{{- $modkey := "Mod4" -}}

{{/* Starship prompt configuration */}}
{{- $starship_languages := list "go" "python" "nodejs" -}}
{{- $starship_show_time := true -}}
{{- $starship_hostname_mode := "always" -}}
{{- $starship_show_icons := true -}}
{{- $starship_theme := "tokyonight" -}}

{{/* Auto-detect profile */}}
{{- if env "WSL_DISTRO_NAME" -}}
{{-   $profile = "wsl" -}}
{{-   $terminal = "foot" -}}
{{-   $modkey = "Mod1" -}}
{{- else if stat "/sys/class/dmi/id/product_name" -}}
{{-   $productName := output "cat" "/sys/class/dmi/id/product_name" | trim -}}
{{-   if or (contains "VMware" $productName) (contains "VirtualBox" $productName) (contains "QEMU" $productName) -}}
{{-     $profile = "vm" -}}
{{-   end -}}
{{- end -}}

{{/* Interactive prompts on first init */}}
{{- if stdinIsATTY -}}
{{-   $profile = promptStringOnce . "profile" "Profile (wsl/vm/bare-metal)" $profile -}}
{{-   $wm = promptStringOnce . "wm" "Window manager (sway/hyprland/i3)" $wm -}}
{{-   $scale = promptStringOnce . "scale" "Display scale (1.0/1.25/1.5/2.0)" $scale -}}
{{-   $multimonitor = promptBoolOnce . "multimonitor" "Multi-monitor setup" $multimonitor -}}
{{-   if eq $profile "wsl" -}}
{{-     $terminal = "foot" -}}
{{-   else -}}
{{-     $terminal = promptStringOnce . "terminal" "Terminal (foot/ghostty)" $terminal -}}
{{-   end -}}
{{- end -}}

[data]
    profile = {{ $profile | quote }}
    wm = {{ $wm | quote }}
    scale = {{ $scale }}
    multimonitor = {{ $multimonitor }}
    terminal = {{ $terminal | quote }}
    modkey = {{ $modkey | quote }}
    hostname = {{ .chezmoi.hostname | quote }}

    # Starship prompt configuration
    starship_languages = {{ $starship_languages | toJson }}
    starship_show_time = {{ $starship_show_time }}
    starship_hostname_mode = {{ $starship_hostname_mode | quote }}
    starship_show_icons = {{ $starship_show_icons }}
    starship_theme = {{ $starship_theme | quote }}
